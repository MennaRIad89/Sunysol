{% extends "layout.html" %}

{% block title %}All Guest Reviews - {{ g.translations.site_title }}{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section all-reviews-hero">
    <div class="hero-content">
        <h1>All Guest Reviews</h1>
        <p>Read what our travelers say about their unforgettable experiences with Menna</p>
    </div>
</section>

<!-- All Reviews Section -->
<section class="all-reviews-section">
    <div class="container">
        <div class="reviews-header">
            <h2>{{ reviews|length }} Happy Travelers Share Their Stories</h2>
            <p>Every review tells a unique story of discovery, friendship, and the magic we create together in the UAE.</p>
        </div>
        
        <div class="all-reviews-grid">
            {% for review in reviews %}
            <article class="full-review-card">
                <div class="review-card-header">
                    <div class="reviewer-profile">
                        <div class="profile-avatar">{{ review.name[0].upper() }}</div>
                        <div class="profile-info">
                            <h3 class="reviewer-full-name">{{ review.name }}</h3>
                            {% if review.nationality %}
                                <span class="reviewer-location">{{ review.nationality }}</span>
                            {% endif %}
                            {% if review.visit_date %}
                                <time class="review-visit-date">Visited: {{ review.visit_date }}</time>
                            {% else %}
                                <time class="review-visit-date">{{ review.created_at.strftime('%B %Y') }}</time>
                            {% endif %}
                        </div>
                    </div>
                    <div class="review-rating-display">
                        {% for i in range(review.rating) %}
                            <i class="fas fa-star star-gold"></i>
                        {% endfor %}
                        {% for i in range(5 - review.rating) %}
                            <i class="far fa-star star-gray"></i>
                        {% endfor %}
                        <span class="rating-text">{{ review.rating }}/5</span>
                    </div>
                </div>
                
                {% if review.tour %}
                    <div class="tour-experience">{{ review.tour }}</div>
                {% endif %}
                
                {% if review.comment %}
                    <div class="review-story">
                        <p>{{ review.comment }}</p>
                    </div>
                {% endif %}
                
                {% if review.photos %}
                    <div class="review-photo-gallery">
                        <h4>Photos from the Experience</h4>
                        <div class="photo-gallery-container" data-review-id="{{ review.id }}">
                            <div class="photo-gallery-slider">
                                {% for photo in review.photos.split(',') %}
                                    <div class="photo-item">
                                        <img src="{{ url_for('static', filename='uploads/reviews/' + photo) }}" 
                                             alt="Photo from {{ review.name }}'s tour" 
                                             class="gallery-image"
                                             data-review-id="{{ review.id }}"
                                             data-photo-index="{{ loop.index0 }}"
                                             onclick="openReviewGallery('{{ review.id }}', {{ loop.index0 }})">
                                    </div>
                                {% endfor %}
                            </div>
                            {% if review.photos.split(',')|length > 4 %}
                                <button class="gallery-nav gallery-prev" onclick="scrollGallery('{{ review.id }}', -1)">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="gallery-nav gallery-next" onclick="scrollGallery('{{ review.id }}', 1)">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </article>
            {% endfor %}
        </div>
        
        {% if not reviews %}
            <div class="no-reviews-state">
                <div class="no-reviews-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <h3>No reviews yet</h3>
                <p>Be the first to share your experience with Menna!</p>
                <a href="/#reviews" class="btn primary-btn">Share Your Review</a>
            </div>
        {% endif %}
        
        <div class="back-to-home">
            <a href="/#reviews" class="btn secondary-btn">
                <i class="fas fa-arrow-left"></i> Back to Homepage
            </a>
        </div>
    </div>
</section>

<!-- Review Gallery Modal -->
<div id="reviewGalleryModal" class="review-gallery-modal" onclick="closeReviewGallery()">
    <div class="review-modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeReviewGallery()">&times;</span>
        <div class="main-image-container">
            <button class="modal-nav modal-prev" onclick="previousModalImage()">
                <i class="fas fa-chevron-left"></i>
            </button>
            <img id="reviewModalImage" src="" alt="Review photo">
            <button class="modal-nav modal-next" onclick="nextModalImage()">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <div class="modal-counter">
            <span id="modalImageCounter"></span>
        </div>
    </div>
</div>

<script>
let currentReviewPhotos = [];
let currentModalIndex = 0;

function openReviewGallery(reviewId, photoIndex) {
    // Get all photos for this specific review
    const reviewContainer = document.querySelector(`[data-review-id="${reviewId}"]`);
    const images = reviewContainer.querySelectorAll('.gallery-image');
    
    currentReviewPhotos = Array.from(images).map(img => img.src);
    currentModalIndex = photoIndex;
    
    updateModalDisplay();
    document.getElementById('reviewGalleryModal').style.display = 'block';
    document.body.style.overflow = 'hidden';
}

function closeReviewGallery() {
    document.getElementById('reviewGalleryModal').style.display = 'none';
    document.body.style.overflow = '';
    currentReviewPhotos = [];
}

function nextModalImage() {
    currentModalIndex = (currentModalIndex + 1) % currentReviewPhotos.length;
    updateModalDisplay();
}

function previousModalImage() {
    currentModalIndex = (currentModalIndex - 1 + currentReviewPhotos.length) % currentReviewPhotos.length;
    updateModalDisplay();
}

function updateModalDisplay() {
    const modalImage = document.getElementById('reviewModalImage');
    const counter = document.getElementById('modalImageCounter');
    
    // Update main image
    modalImage.src = currentReviewPhotos[currentModalIndex];
    
    // Update counter
    counter.textContent = `${currentModalIndex + 1} / ${currentReviewPhotos.length}`;
}

function scrollGallery(reviewId, direction) {
    const container = document.querySelector(`[data-review-id="${reviewId}"] .photo-gallery-slider`);
    const scrollAmount = 150;
    container.scrollBy({
        left: direction * scrollAmount,
        behavior: 'smooth'
    });
}

// Close modal with escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeReviewGallery();
    }
    if (document.getElementById('reviewGalleryModal').style.display === 'block') {
        if (event.key === 'ArrowLeft') {
            previousModalImage();
        } else if (event.key === 'ArrowRight') {
            nextModalImage();
        }
    }
});
</script>
{% endblock %}